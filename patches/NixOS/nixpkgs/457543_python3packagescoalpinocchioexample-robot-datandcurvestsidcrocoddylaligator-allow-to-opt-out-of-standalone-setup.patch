From 8da525f64895a47a08f915259f87da25bb0a1323 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:28:54 +0100
Subject: [PATCH 1/7] python3Packages.coal: make standalone optional

---
 pkgs/development/python-modules/coal/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/coal/default.nix b/pkgs/development/python-modules/coal/default.nix
index 773de813e0dac..b3bdd19b6aa41 100644
--- a/pkgs/development/python-modules/coal/default.nix
+++ b/pkgs/development/python-modules/coal/default.nix
@@ -10,6 +10,8 @@
   eigenpy,
   pylatexenc,
   numpy,
+
+  standalone ? true,
 }:
 toPythonModule (
   coal.overrideAttrs (super: {
@@ -17,7 +19,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
 
     # those are used by CMake at configure/build time
@@ -26,11 +28,12 @@ toPythonModule (
       pylatexenc
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
+    propagatedBuildInputs = [
       boost
-      coal
       eigenpy
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone coal;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From 92a3e7773187bb5be2a3896d4467a94e12e0f85d Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:08 +0100
Subject: [PATCH 2/7] python3Packages.pinocchio: make standalone optional

---
 pkgs/development/python-modules/pinocchio/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/pinocchio/default.nix b/pkgs/development/python-modules/pinocchio/default.nix
index d2f722d9ee5c6..6acf36e0cbb60 100644
--- a/pkgs/development/python-modules/pinocchio/default.nix
+++ b/pkgs/development/python-modules/pinocchio/default.nix
@@ -10,6 +10,8 @@
   casadi,
   matplotlib,
   python,
+
+  standalone ? true,
 }:
 toPythonModule (
   pinocchio.overrideAttrs (super: {
@@ -17,18 +19,19 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
 
     nativeBuildInputs = super.nativeBuildInputs ++ [
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
+    propagatedBuildInputs = [
       casadi
       coal
-      pinocchio
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone pinocchio;
 
     checkInputs = super.checkInputs ++ [
       matplotlib

From fed984e5e78e4aeeaba311b83b0f3d4298ecf8a7 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:24 +0100
Subject: [PATCH 3/7] python3Packages.example-robot-data: make standalone
 optional

---
 .../python-modules/example-robot-data/default.nix     | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/example-robot-data/default.nix b/pkgs/development/python-modules/example-robot-data/default.nix
index 3a9bfc18b39df..dec8878cfb6aa 100644
--- a/pkgs/development/python-modules/example-robot-data/default.nix
+++ b/pkgs/development/python-modules/example-robot-data/default.nix
@@ -8,6 +8,8 @@
 
   python,
   pinocchio,
+
+  standalone ? true,
 }:
 toPythonModule (
   example-robot-data.overrideAttrs (super: {
@@ -15,17 +17,18 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
 
     nativeBuildInputs = super.nativeBuildInputs ++ [
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
-      example-robot-data
+    propagatedBuildInputs = [
       pinocchio
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone example-robot-data;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From 8bd35bd19156552883d7449da343be408278cc72 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:44 +0100
Subject: [PATCH 4/7] python3Packages.ndcurves: make standalone optional

---
 pkgs/development/python-modules/ndcurves/default.nix | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/pkgs/development/python-modules/ndcurves/default.nix b/pkgs/development/python-modules/ndcurves/default.nix
index 885cfa64a0245..e7826c837d5ce 100644
--- a/pkgs/development/python-modules/ndcurves/default.nix
+++ b/pkgs/development/python-modules/ndcurves/default.nix
@@ -9,13 +9,15 @@
   boost,
   pinocchio,
   python,
+
+  standalone ? true,
 }:
 toPythonModule (
   ndcurves.overrideAttrs (super: {
     pname = "py-${super.pname}";
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
     # those are used by CMake at configure/build time
     nativeBuildInputs = super.nativeBuildInputs ++ [
@@ -24,12 +26,14 @@ toPythonModule (
     propagatedBuildInputs = [
       boost
       pinocchio
-      ndcurves
     ]
-    ++ super.propagatedBuildInputs;
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone ndcurves;
+
     nativeCheckInputs = [
       pythonImportsCheckHook
     ];
+
     pythonImportsCheck = [
       "ndcurves"
     ];

From 31c9d3187677cfab40986586a16b0783e8608d5c Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:53 +0100
Subject: [PATCH 5/7] python3Packages.tsid: make standalone optional

---
 pkgs/development/python-modules/tsid/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/tsid/default.nix b/pkgs/development/python-modules/tsid/default.nix
index 3894c80d28540..1d114b58262e4 100644
--- a/pkgs/development/python-modules/tsid/default.nix
+++ b/pkgs/development/python-modules/tsid/default.nix
@@ -8,6 +8,8 @@
 
   pinocchio,
   python,
+
+  standalone ? true,
 }:
 toPythonModule (
   tsid.overrideAttrs (super: {
@@ -15,7 +17,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
 
     # those are used by CMake at configure/build time
@@ -23,10 +25,11 @@ toPythonModule (
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
+    propagatedBuildInputs = [
       pinocchio
-      tsid
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone tsid;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From 40ea0c63a734ae1bd11269bafe8f0106fbaa3369 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:30:03 +0100
Subject: [PATCH 6/7] python3Packages.crocoddyl: make standalone optional

---
 pkgs/development/python-modules/crocoddyl/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/crocoddyl/default.nix b/pkgs/development/python-modules/crocoddyl/default.nix
index 5e5e449899f02..f9fd0165e756c 100644
--- a/pkgs/development/python-modules/crocoddyl/default.nix
+++ b/pkgs/development/python-modules/crocoddyl/default.nix
@@ -14,6 +14,8 @@
   ipykernel,
   python,
   scipy,
+
+  standalone ? true,
 }:
 toPythonModule (
   crocoddyl.overrideAttrs (super: {
@@ -21,7 +23,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
 
     # those are used by CMake at configure/build time
@@ -29,10 +31,11 @@ toPythonModule (
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
-      crocoddyl
+    propagatedBuildInputs = [
       example-robot-data
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone crocoddyl;
 
     nativeCheckInputs = [
       ffmpeg

From 7f6585e6fe9c7ab388c33b1a4e8e3ec74d184262 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:30:14 +0100
Subject: [PATCH 7/7] python3Packages.aligator: make standalone optional

---
 pkgs/development/python-modules/aligator/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/aligator/default.nix b/pkgs/development/python-modules/aligator/default.nix
index 6ef954f53a0ee..cd3da9a896335 100644
--- a/pkgs/development/python-modules/aligator/default.nix
+++ b/pkgs/development/python-modules/aligator/default.nix
@@ -12,6 +12,8 @@
   python,
   matplotlib,
   pytest,
+
+  standalone ? true,
 }:
 toPythonModule (
   aligator.overrideAttrs (super: {
@@ -19,7 +21,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" standalone)
     ];
 
     # this is used by CMake at configure/build time
@@ -27,11 +29,12 @@ toPythonModule (
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
-      aligator
+    propagatedBuildInputs = [
       crocoddyl
       pinocchio
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional standalone aligator;
 
     nativeCheckInputs = [
       pythonImportsCheckHook
